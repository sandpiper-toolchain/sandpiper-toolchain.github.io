name: Deploy to built site repo
on: [push]
jobs:
  build:
    runs-on: ubuntu-latest
    steps:
        - uses: actions/checkout@v2

        - name: Install Ruby, Jekyll, and dependencies
          uses: ruby/setup-ruby@v1
          with:
            ruby-version: '3.0'
            bundler-cache: true # runs 'bundle install'

        - name: Build
          run: |
            JEKYLL_ENV=production
            export JEKYLL_ENV=production
            bundle exec jekyll build --trace

        - name: Upload static files as artifact
          id: deployment
          uses: actions/upload-pages-artifact@v3 # or specific "vX.X.X" version tag for this action
          retention-days: 5
          with:
            path: _site/

  deploy:
    runs-on: ubuntu-latest
    steps:
        - name: deploy changes to a repo
          uses: tagus/git-deploy@v0.5.0
          with:
            changes: public
            repository: git@github.com:sandpiper-toolchain/sandpiper-toolchain.github.io.git
            ssh_key: ${{ secrets.GITHUB_TOKEN }}
            name: bot
            email: bot@sandpiper-toolchain
            clean_repo: true